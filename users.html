<!DOCTYPE html>
<html lang="en">
<head>  
  <meta charset="UTF-8">  
  <title>User Portal</title>  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">  
</head>  
<body class="bg-light">  
  
 
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">  
    <div class="container-fluid">  
      <a class="navbar-brand" href="index.html">üç¥ Meal Planner</a>  
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">  
        <span class="navbar-toggler-icon"></span>  
      </button>  
      <div class="collapse navbar-collapse" id="navbarNav">  
        <ul class="navbar-nav">  
          <li class="nav-item"><a class="nav-link" href="index.html">Recipes</a></li>  
          <li class="nav-item"><a class="nav-link" href="pantry.html">Pantry</a></li>  
          <li class="nav-item"><a class="nav-link" href="recommendations.html">Recommendations</a></li>  
          <li class="nav-item"><a class="nav-link" href="ingredients.html">Ingredients</a></li>  
          <li class="nav-item"><a class="nav-link" href="groceries.html">Groceries</a></li>  
          <li class="nav-item"><a class="nav-link active" href="users.html">Users</a></li>  
        </ul>  
      </div>  
    </div>  
  </nav>  
   
  
  <div class="container mt-4">  
    <h1 class="text-center mb-4">üë§ User Portal</h1>  
  
     
    <form id="regForm" class="row g-3 mb-4">  
      <div class="col-md-6"><input name="name" class="form-control" placeholder="Name" required></div>  
      <div class="col-md-6"><input type="email" name="email" class="form-control" placeholder="Email" required></div>  
      <div class="col-md-6"><input type="password" name="password" class="form-control" placeholder="Password" required></div>  
      <div class="col-md-3"><input type="number" name="age" class="form-control" placeholder="Age"></div>  
      <div class="col-md-3"><input type="number" name="weight" class="form-control" placeholder="Weight"></div>  
      <div class="col-md-6">
  <label for="fitness_goal" class="form-label">Fitness Goal</label>
  <select name="fitness_goal" id="fitness_goal" class="form-select" required>
    <option value="">Select goal...</option>
    <option value="Muscle Gain">Muscle Gain</option>
    <option value="Weight Loss">Weight Loss</option>
    <option value="General Health">General Health</option>
    <option value="Endurance">Endurance</option>
    <option value="Flexibility">Flexibility</option>
  </select>
</div>
 
      <div class="col-md-6">
  <label for="dietary_restrictions" class="form-label">Dietary Restrictions</label>
  <select name="dietary_restrictions" id="dietary_restrictions" class="form-select" required>
    <option value="">Select dietary preference...</option>
    <option value="None">None</option>
    <option value="Vegetarian">Vegetarian</option>
    <option value="Vegan">Vegan</option>
    <option value="Gluten-Free">Gluten-Free</option>
    <option value="Keto">Keto</option>
    <option value="Lactose Intolerant">Lactose Intolerant</option>
  </select>
</div>
  
      <div class="col-12 text-end"><button class="btn btn-success">Register</button></div>  
    </form>  
  
     
    <form id="loginForm" class="row g-3 mb-4">  
      <div class="col-md-5"><input name="email" class="form-control" placeholder="Email" required></div>  
      <div class="col-md-5"><input type="password" name="password" class="form-control" placeholder="Password" required></div>  
      <div class="col-md-2 d-grid"><button class="btn btn-primary">Login</button></div>  
    </form>  
  
    <div id="userInfo" class="alert alert-info d-none"></div>  
  </div>  
  
  <script>  
    document.getElementById('regForm').addEventListener('submit', async e => {
  e.preventDefault();
  const data = Object.fromEntries(new FormData(e.target).entries());

  try {
    const res = await fetch('/users', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });

    if (!res.ok) {
  const errorText = await res.text();
  throw new Error(errorText || 'Registration failed');
}
    const user = await res.json();
    alert('User registered with ID: ' + user.user_id);
    e.target.reset();
  } catch (err) {
    alert('Error: ' + err.message);
  }
});

    document.getElementById('loginForm').addEventListener('submit', async e => {
  e.preventDefault();
  const creds = Object.fromEntries(new FormData(e.target).entries());
  const res = await fetch('/login', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(creds)
  });
  if (!res.ok) {
    alert('Login failed');
    return;
  }
  const user = await res.json();
  console.log('Logged in as:', user);
  localStorage.setItem('user', JSON.stringify(user));
  showUserInfo();   // your existing function to update the banner
});

    document.getElementById('loginForm').addEventListener('submit', async e => {  
      e.preventDefault();  
      const data = Object.fromEntries(new FormData(e.target).entries());  
      const res = await fetch('/login', {  
        method: 'POST',  
        headers: {'Content-Type':'application/json'},  
        body: JSON.stringify(data)  
      });  
      if (!res.ok) return alert('Login failed');  
      const user = await res.json();  
      localStorage.setItem('user', JSON.stringify(user));  
      showUserInfo();  
    });  
  
    function showUserInfo() {  
      const user = JSON.parse(localStorage.getItem('user'));  
      if (!user) return;  
      const div = document.getElementById('userInfo');  
      div.classList.remove('d-none');  
      div.textContent = `Hello ${user.name}! Goal: ${user.fitness_goal}, Dietary: ${user.dietary_restrictions}`;  
    }  
  
    window.addEventListener('DOMContentLoaded', showUserInfo);

  </script>  
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>  
</body>  
</html>
